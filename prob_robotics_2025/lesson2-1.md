---
marp: true
---

<!-- footer: 確率ロボティクス第2回（その1） -->

# 確率ロボティクス第2回: 確率と信頼性工学（その1）

千葉工業大学 上田 隆一

<br />

<p style="font-size:50%">
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
</p>

---

<!-- paginate: true -->

## 今回の内容

- 確率の基礎+信頼性工学
    - 確率を意識しながらロボットを運用する話
- 内容
    - 確率と事象
    - 簡単な確率の計算

---

### こんな経験はありませんか？

- ロボットのなにかの大会に出た$\rightarrow$ロボットが始動しなくてリタイアになった
* <span style="color:red">$\uparrow$「運が悪かった」で済ませていませんか？</span>
* <span style="color:red">$\uparrow$ほんとに運が悪かったんですか？</span>
* <span style="color:red">$\uparrow$リタイアした原因だけつぶして満足していませんか？</span>
* <span style="color:red">$\uparrow$なんどもこんなことを繰り返していませんか？</span>
* そういう人はおそらくロボットへの知識ではなく<span style="color:red">信頼性工学</span>の知識が足りません
    - 勉強していきましょう
    - 信頼性工学は確率を駆使するので、確率の基礎もおさえていきましょう


---

## 確率と事象

- 信頼性工学に入る前に

---

### 確率の定義

- 数学的に厳密なものは難しいので、とりあえずこう考える
    - 何か事象が起こるかどうかを予測するときに、
    同じ状況で統計をとって、起こる割合を確率に
    - 例: ロボットの部品Aが、これまで100回ロボットを起動して
    90回だけ正常に立ち上がった$\Rightarrow$確率$90/100 = 0.9$と考える

<center>素朴すぎるのですが当面これで議論</center>

---

### 確率の表記

- 記号での表記: 事象Xの起こる確率を$\Pr\{$X$\}$と表記
（事象Aはなんでもよい）
    - 前ページの例: $\Pr\{$Aが正しく立ち上がる$\}=0.9$
- あとから出てくる$P(x), P(\boldsymbol{x})$との違い（本書の場合）
    - この表記の場合は$x$や$\boldsymbol{x}$はそれぞれスカラやベクトル
        - $P$は定義域が数直線やベクトルの空間で厳密に決まった関数
    - 例: サイコロ
        - $P(1) = 1/6$と書けても$P($ 5以外の数 $)$とは書けない
- $\Pr\{$X$\}$のXは事象なので、なんでも書ける
    - 例: $\Pr\{$ 5以外の数 $\}$
    - 事象の集合に対する関数になっている

---

## 確率の計算

- ロボットの起動率の計算を例に

---

### 例題

- このような単純化されたケースを考えましょう
    - ロボットが10個の部品A$_1$, A$_2$, $\dots$, A$_{10}$で構成されていると仮定
    - ロボットの主電源を入れてしばらくするとA$_{1:10}$が使えるようになる
        - それぞれ「起動する」と表現
    - A$_{1:10}$どれかが起動しないとロボットが正しく起動しない
    - ある部品の起動の成否は他の部品の起動の成否に影響しない
- 最初の問題
    - A$_1$が正しく起動する確率（起動率）が$0.8$、他の部品の起動率が
    $0.95$とした場合、ロボットが正しく起動する確率は？
    - 計算方法は解説していませんが、とりあえずこれまでの知識でどうぞ


---

### 答え

- $\Pr\{$A$_{1:10}$が起動$\} = \prod_{i=1}^{10} \Pr\{$A$_i$が起動$\}= 0.8\cdot 0.95^9 = 0.50$
と、掛け算になる
    - 答えをみると2回に1回起動しないことが分かる
    - こういう状態で何かに参加しても2回に1回リタイアとなる
- うんちく
    - 構成要素が1つでも動かないと動かない構成のロボットや機械，
    工場や物流の仕組みのことは，<span style="color:red">直列システム</span>と呼ばれる
    - 直列システムが正しく稼働する確率:
        - 各構成要素が正しく稼働する確率の掛け算
        - <span style="color:red">掛け算で正しく稼働する確率が減る</span>

---

### もうひとつ問題

- さっきのロボットを運用しているチームは、部品A$_1$の起動率が低いことを気にして原因を突き止めて起動率を$1.0$にしました。ロボットの起動率は？
    - 他の部品の起動率は$0.95$のまま
- 答え
    * $\Pr\{$A$_{1:10}$が起動$\}=$（中略）$=1.0\cdot 0.95^9 = 0.63$（<span style="color:red">そんなに改善しない</span>）
    * A$_1$の改善は必要だが他の部品についても改善する必要がある
- 学生を見ていてよくあるなあと思うやつ
    * 興味のあるところしか見ていなくて全体を見ていない
    * ロボットを走らせると興味のなかったところで不具合が起こり、
    ひどい場合にはそれを棚上げにする$\Rightarrow$毎年リタイア
    * （ロボット関係ないけど）理論派を自称する連中も大抵これ

---

### さらに問題

- ロボットの起動率を$0.9$まで引き上げるには、各部品の起動率をどこまで向上させる必要があるでしょうか？すべての部品を同じ起動率$\alpha$まで引き上げる場合、$\alpha$の値はいくつでしょうか？
- 答え
    * $\alpha^{10} = 0.9$
    * $\alpha = 0.99$
* <span style="color:red">「たまに動かないけどまあいいや」みたいな部品は、基本使ってはならない</span>


---

### ここまでのまとめ

- 起動率を計算すると、たまに頭で考えていることと違う答えが出てくる
- 人間は自分の興味に引きずられて現実を歪んだ姿で見る
    - 失敗を冷静に考察できない人はまた同じ失敗をする
    - 確率の計算ができれば、その歪みも多少マシになるでしょう
<br />　
<center>ということで、もっと確率の計算ができるようにしましょう</center>

---

## 確率の計算

---

### 直列システムの起動率はなぜ掛け算になる？

- さきほど、直列システムの起動率を掛け算で求めた
    - なんで掛け算？
    - ここでは確率の計算の定理を正しいとして、機械的に考えてみましょう
        - <span style="color:red">乗法定理</span>という定理を使う


---

### 乗法定理

- $\text{Pr}\{$AとBが起きる$\} = \text{Pr}\{$Aが起きる|Bが起きる$\}\text{Pr}\{$Bが起きる$\}$
    - $\text{Pr}\{$Aが起きる|Bが起きる$\}$: Bが起きることが分かっているときに
    Aが起きる確率（<span style="color:red">条件付き確率</span>）
        - $|$の右側は「<span style="color:red">条件</span>」
- 直列システムに適用するとこうなる
    - $\Pr\{$A$_{1:10}$が起動$\} = \Pr\{$A$_{2:10}$が起動|A$_1$が起動$\}\Pr\{$A$_1$が起動$\}$
        - $\Pr\{$A$_{2:10}$が起動|A$_1$が起動$\}$について考察してみましょう


---

### 独立

- $\Pr\{$A$_{2:10}$が起動|A$_1$が起動$\}$
   - ある部品の起動の成否は他の部品の起動の成否に影響しないと条件にあった
   <span style="color:red">$\Rightarrow$条件を削除可能</span>
- このような事象の無関係性を<span style="color:red">独立</span>という
- 独立な事象$X$と$Y$の関係:
	- $\Pr\{X \cap Y\} = \Pr\{X | Y\}\Pr\{Y\} = \Pr\{X\}\Pr\{Y\}$
	- $\Pr\{X \cap Y\} = \Pr\{Y | X\}\Pr\{X\} = \Pr\{X\}\Pr\{Y\}$
	    - $\cap$は集合の共通部分を抽出する演算子
	- 表記: $X\perp\!\!\!\!\perp Y$
- 独立でない場合は<span style="color:red">従属</span>といわれる
	- 表記: $X\not\perp\!\!\!\!\!\perp Y$

---

### 直列システムの起動率

- したがって
    - $\Pr\{$A$_{1:10}$が起動$\}$
    $= \Pr\{$A$_{2:10}$が起動|<del>A$_1$が起動</del>$\}\Pr\{$A$_1$が起動$\}$
    $= \Pr\{$A$_{2:10}$が起動$\}\Pr\{$A$_1$が起動$\}$
- 同様にA$_2$、A$_3$、・・・を乗法定理で外に出して条件から消していくと
    $\Pr\{$A$_{1:10}$が起動$\} = \prod_{i=1}^{10} \Pr\{$A$_i$が起動$\}$
    が成立

---

### 別の例: 冗長化されたシステム

- 部品A$_1$の起動率を上げるために、次のように複数の部品a$_{1:3}$に置き換え、
どれが壊れても問題ないようにしました。a$_{1:3}$はハブa$_4$につながれています。
![w:700](./figs/redundant_a1.gif)
    - 起動率はどう計算するんでしょうか？（こんどは掛け算にはならない）

---

### 加法定理

- 確率の足し算に関する定理
	- $\Pr\{$A、Bどちらかor両方起こる$\} = \Pr\{$Aが起こる$\} + \Pr\{$Bが起こる$\}$
    $\qquad\ \qquad\qquad\qquad\qquad\qquad- \Pr\{$AとBが両方起こる$\}$
- とくにAとBが同時に起こりえない場合
	- $\Pr\{$AあるいはBが起こる$\} = \Pr\{$Aが起こる$\} + \Pr\{$Bが起こる$\}$
	が成立
    - AとBが同時に起こりえない: （互いに）<span style="color:red">排反</span>と表現
        - 例: 「さいころの目が偶数」と「さいころの目が奇数」は排反
        - 排反の場合$A \cap B = \varnothing$
            - $\varnothing$（あるいは$\phi$）: <span style="color:red">空事象</span>（起こり得ない事象）

---

### 確率の計算方法のまとめ

- 重要: 実は乗法定理と加法定理しか定理がない
    - 普通の算数よりも規則が少ない
- 乗法定理
    - $\text{Pr}\{$X$\cap$Y$\} = \text{Pr}\{$X$|$Y$\}\text{Pr}\{$Y$\}$
    - 独立な場合: $\text{Pr}\{$X$\cap$Y$\} = \text{Pr}\{$X$\}\text{Pr}\{$Y$\}$
    - 互いに独立なX$_{1:n}$に対し: $\text{Pr}\{\bigcap_{i=1}^n$X$\} = \prod_{i=1}^n\text{Pr}\{$X$_i\}$
- 加法定理
	- $\Pr\{$X$\cup$Y$\} = \Pr\{$X$\} + \Pr\{$Y$\} - \Pr\{$X$\cap$Y$\}$
        - $\cup$は左右の集合を合併するときの演算子
    - 排反な場合: $\Pr\{$X$\cup$Y$\} = \Pr\{$X$\} + \Pr\{$Y$\}$
    - 互いに排反なX$_{1:n}$に対し: $\text{Pr}\{\bigcup_{i=1}^n$X$\} = \sum_{i=1}^n\text{Pr}\{$X$_i\}$

---

### 冗長化したシステムの起動率

- a$_{1:3}$の起動率をそれぞれ$0.8$としましょう
- a$_4$を除いたa$_{1:3}$が1つ以上起動する確率の計算
   - 「1つ以上起動」を排反な事象に切り分ける
       - a$_1$が起動
           - 確率$0.8$
       - a$_1$が起動せず，a$_{2}$が起動
           - 確率: $0.2\cdot 0.8 = 0.16$
       - a$_{1:2}$が両方起動せず，a$_{3}$が起動
           - 確率$0.2^2 \cdot 0.8 = 0.032$
   - $\Rightarrow$合計の確率: $0.992$

![bg right:30% 100%](./figs/redundant_a1_2.png)

---

### 計算の続き（単一故障点）

- a$_4$が起動しないと冗長化したA$_1$は起動しない
    - <span style="color:red">単一故障点（単一障害点）</span>と呼ばれる
- 冗長化したA$_1$の計算結果
    - a$_{1:3}$全体とa$_4$は直列なので、前ページの結果に
    a$_4$の起動率（$\alpha$とおく）をかける<span style="color:red">$\Rightarrow 0.992 \alpha$</span>
- 具体例1: $\alpha = 0.95$
    - 起動率: $0.992\cdot 0.95 = 0.94$（> A$_1$の起動率）
- 具体例2: $\alpha = 0.8$
    - 起動率: $0.992\cdot 0.8 = 0.79$（< A$_1$の起動率）

<span style="color:red">結局、a$_4$の信頼性が相当高くないと冗長化の効果は少ない</span>

![bg right:25% 100%](./figs/redundant_a1_2.png)

---

### もうひとつの計算方法: 余事象を使用

- <span style="color:red">余事象</span>
    - ある事象Xに対し、<span style="color:red">全事象</span>（起こりうる全ての事象）からあるXを除いた事象
    - 事象Xに対して余事象はX$^c$と表記
    - サイコロの例: 「偶数が出る」の余事象は「奇数が出る」
- 余事象を使った計算
    - 「a$_{1:3}$が1つ以上起動」の余事象は「a$_{1:3}$が全て起動しない」
    - $\Pr\{$a$_{1:3}$が1つ以上起動$\} = 1 - (0.2)^3 = 0.992$

---

### 部品が互いに影響を与える場合

- 今度は次のようなケースを考えてみましょう
    - A$_{10}$は電源回路で、某チームは
    X君作とY君作の2つのものを使用
        - X君のもの高起動率/電流が少し不安定
        - Y君のものて低起動率/電流は安定
    - A$_{1:5}$の起動率がX君、Y君のA$_{10}$で違う
    （右下の表）

<center>どっちを使ったほうがいい？</center>

![bg right:35% 95%](./figs/dependency.png)

---

### 解き方

- 式をたてる
	- $\Pr\{$ロボットが起動$|$誰のA$_{10}$か$\}$
- 面倒なので略記
	- $\Pr\{$A$_{1:10}|$Z$\}$
        - 「A$_{1:10}$が起動」を単に「A$_{1:10}$」
        - 誰のA$_{10}$かを単にZ（ZにはX君、Y君どっちかが入る）とする
- 条件がある場合の乗法定理を使用
    - $\Pr\{X \cap Y | Z \} = \Pr\{X | Y \cap Z \} \Pr\{Y | Z \}$
        - 条件を無視して乗法定理を使い、最後に条件を入れるだけ
        - 導出は「ロボットの確率・統計」に

---

### 式の展開

- $\Pr\{$A$_{1:10}|$Z$\}=\Pr\{$A$_{1:5}\cap$A$_{10}|$A$_{6:9}\cap$Z$\}\Pr\{$A$_{6:9}|$Z$\}$（部品A$_{6:9}$を条件に移動）
$=\Pr\{$A$_{1:5}\cap$A$_{10}|$Z$\}\Pr\{$A$_{6:9}\}\qquad\quad\qquad\qquad\quad$（不要な条件を消去）
$=\Pr\{$A$_{1:5}|$A$_{10}\cap$Z$\}\Pr\{$A$_{10}|$Z$\}\Pr\{$A$_{6:9}\}\qquad\qquad$ （A$_{10}$を条件に移動）
$=\big(\prod_{i=1}^5\Pr\{$A$_i|$A$_{10}\cap$Z$\}\big)\Pr\{$A$_{10}|$Z$\}\big(\prod_{j=6}^9\Pr\{$A$_j\}\big)$（独立性から分解）

<center style="color:red">乗法定理と独立を使って分解していく<br />（確率ロボティクスや機械学習のアルゴリズムの導出の基本）</center>

---

### 値の代入

- 最終的な式
    - $\Pr\{$ロボットが起動$|$Z$\}$
    $= \big(\prod_{i=1}^5\Pr\{$A$_i|$A$_{10}\cap$Z$\}\big)$
    $\quad\cdot\Pr\{$A$_{10}|$Z$\}\cdot\big(\prod_{j=6}^9\Pr\{$A$_j\}\big)$
- 表の数値を当てはめ
    - Z=X君の場合: $0.9^5\cdot 0.99 \cdot 0.95^4 \simeq 0.48$
    - Z=Y君の場合: $0.95^5\cdot 0.9 \cdot 0.95^4 \simeq 0.57$

<center style="color:red">Y君のものをつかったほうがよい</center><center>（どっちもどっちだけど）</center>


![bg right:35% 95%](./figs/dependency.png)


---

### 条件の後付け

- もうひとつ、アルゴリズムの導出に出てくるタイプの問題を解いてみましょう

---

{2.3}\SEVENjidori {部品が互いに影響を与える場合}}{35}
{2.3.1}\SEVENjidori {乗法定理による計算}}{36}
{2.3.2}\SEVENjidori {隠れた条件と加法定理}}{38}
{\hbox to2zw{{\rm (}\hfill 1\hfill {\rm )}}}今まで考えてこなかった条件を式に加える}{38}
{\hbox to2zw{{\rm (}\hfill 2\hfill {\rm )}}}例}{40}
{2.4}\SEVENjidori {確率変数，確率質量関数と確率分布}}{42}
{2.4.1}\SEVENjidori {確率変数}}{42}
{2.4.2}\SEVENjidori {確率質量関数}}{43}
{2.4.3}\SEVENjidori {確率分布}}{43}
{2.4.4}\SEVENjidori {確率分布と事象の関係}}{45}
{2.4.5}\SEVENjidori {同時確率質量関数，同時確率分布}}{46}
{2.5}\SEVENjidori {まとめと議論}}{47}

---

### 様々なタイプの事象1

- 根元事象
    - それ以上分けられない（と決めた）事象
        - サイコロの例: 1〜6の出目
        - 根元事象でない事象の例: サイコロの出目が偶数 
- 全事象
    - 起こりうるすべての事象を含んだ事象
        - サイコロの例: 1〜6のどれかが出る

<span style="font-size:80%">注意: ほんとうは標本空間などを定義して厳密にする話なんですけど、ここでは曖昧に説明しています。</span>

---

### 様々なタイプの事象2

- 空事象
    - 起こらない事象で$\varnothing$あるいは$\phi$と表記
    - 集合論の空集合に相当（集合論で確率を定義するときに出てくる）
    - $\Pr\{\varnothing\} = 0$
